<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.mtl.admin.accomodation.AdminReservationMapper">

	<!-- 예약내역 리스트 총 개수 --> 
	<!-- param : partner_idx -->
	<select id="getReservationListCount" parameterType="map">
		SELECT COUNT(*)
		FROM RESERVATION r JOIN ROOM rm ON (r.room_idx = rm.idx) JOIN USER u ON (r.user_idx = u.idx)
		WHERE r.partner_idx = #{partner_idx}
	</select> 
	    
	<!-- 예약내역 리스트 전체 조회-->
	<!-- param : partner_idx, 및 필터들
		  * 다중행 반환 List 형태로 반환되어야 함.  -->  
	<select id="getReservationList" parameterType="map"  resultType="map">
		SELECT r.idx AS reservation_idx, u.name AS username, rm.room_type, r.check_in_date, r.check_out_date, DATE_FORMAT(r.reservation_date, '%Y-%m-%d') AS reservation_date, r.payment_status, r.price
		FROM RESERVATION r JOIN ROOM rm ON (r.room_idx = rm.idx) JOIN USER u ON (r.user_idx = u.idx)
	<!-- 필터적용 해야함 -->	
       
		<!-- 페이징 처리 -->
	    <if test="limit != null and offset != null">
	        LIMIT ${limit} OFFSET ${offset}
	    </if>

	</select>
		 
		 
	<!-- 예약내역 상세조회 -->
	<!-- param : reservation_idx(예약idx 값 받아서 조회)
		  * 단일행 반환 Map 형태로 반환되어야 함.  -->
	<select id="getReservationDetail" parameterType="map">
		SELECT r.idx AS reservation_idx, u.name AS username, u.phone AS userphone, rm.room_type, r.check_in_date, r.check_out_date, DATE_FORMAT(r.reservation_date, '%Y-%m-%d') AS reservation_date, r.payment_status, r.price, r.calculate_price
		FROM RESERVATION r JOIN ROOM rm ON (r.room_idx = rm.idx) JOIN USER u ON (r.user_idx = u.idx)
		WHERE r.idx = #{reservation_idx}
	</select>
	
	<!-- 판매자 idx로 조회해서 판매자가 등록해둔 객실타입 조회 (=> 예약내역 검색필터에 객실타입 동적으로 뿌리기 위함) -->
	<select id="getRoomTypeList" parameterType="map">
		SELECT p.idx AS partner_idx, r.idx AS room_idx, r.room_type
		FROM PARTNER p JOIN ROOM r ON (p.idx = r.partner_idx) 
		WHERE p.idx = #{partner_idx}
	</select>



</mapper>