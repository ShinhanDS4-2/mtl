<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.mtl.question.AQuestionMapper">
	
<select id="selectQuestions" parameterType="map" resultType="map">
    SELECT
        idx,
        title,
        content,
        create_date,
        answer,
        answerYN,
        u.name AS userName
    FROM 
        QUESTION
    LEFT JOIN USER u ON QUESTION.user_idx = u.idx
    <where>
        <if test="answerStatus != null and answerStatus != ''">
            AND answerYN = #{answerStatus}
        </if>
        <if test="searchField != null and searchField != '' and searchText != ''">
            <choose>
                <when test="searchField == 'userName'">
                    AND u.name LIKE CONCAT('%', #{searchText}, '%')
                </when>
                <when test="searchField == 'content'">
                    AND content LIKE CONCAT('%', #{searchText}, '%')
                </when>
            </choose>
        </if>
    </where>
    ORDER BY create_date DESC
    LIMIT #{limit} OFFSET #{offset}
</select>

<select id="getTotal" resultType="int">
    SELECT COUNT(*)
    FROM QUESTION
</select>

<select id="getQuestionDetail" parameterType="int" resultType="map">
    SELECT 
        idx,
        title,
        content,
        create_date,
        answer,
        answerYN
    FROM 
        QUESTION
    WHERE idx = #{idx}
</select>

</mapper>